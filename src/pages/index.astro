---
import BaseLayout from '../layouts/BaseLayout.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import ProductCard from '../components/ProductCard.astro';
import { ShoppingCart } from '../components/ShoppingCart';

// Load products from JSON file
let products = [];
try {
  const response = await fetch(new URL('/data/products.json', Astro.site || 'http://localhost:4321'));
  products = await response.json();
} catch (error) {
  console.error('Failed to load products:', error);
}

// Separate featured and regular products
const featuredProducts = products.filter((p: any) => p.isFeatured);
const regularProducts = products.filter((p: any) => !p.isFeatured);

// Site ID (this would come from ContentFlow CMS deployment)
const siteId = import.meta.env.PUBLIC_SITE_ID || 'demo-site-id';
---

<BaseLayout
  title="Wellstone Breads - Artisan Baked Fresh Daily"
  description="Handcrafted sourdough bread, focaccia, and pretzels baked fresh daily. Order online for pickup."
>
  <Header />

  <main>
    <!-- Hero Section -->
    <section class="relative bg-gradient-to-br from-primary-50 via-accent-50 to-neutral-50 overflow-hidden">
      <!-- Decorative background pattern -->
      <div class="absolute inset-0 bg-texture opacity-30"></div>

      <div class="relative container-custom section">
        <div class="max-w-4xl mx-auto text-center">
          <div class="inline-block mb-6 animate-fade-in-up">
            <span class="badge-accent text-base px-6 py-2">
              üåæ Fresh Daily from Nicole's Kitchen
            </span>
          </div>

          <h1 class="text-4xl md:text-5xl lg:text-6xl font-serif font-bold text-primary-900 mb-6 animate-fade-in-up">
            Artisan Breads<br class="hidden sm:block" />
            <span class="text-gradient-primary">Baked Fresh Daily</span>
          </h1>

          <p class="text-lg md:text-xl text-neutral-700 mb-10 max-w-2xl mx-auto leading-relaxed animate-fade-in-up">
            Handcrafted with care using traditional methods and the finest ingredients.
            Every loaf tells a story of patience, passion, and perfection.
          </p>

          <div class="flex flex-col sm:flex-row gap-4 justify-center animate-fade-in-up">
            <a href="#products" class="btn-primary btn-lg">
              Shop Now
            </a>
            <a href="#about" class="btn-outline btn-lg">
              Learn More
            </a>
          </div>
        </div>

        <!-- Feature highlights -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mt-20 max-w-4xl mx-auto">
          <div class="card text-center p-6 animate-fade-in">
            <div class="text-4xl mb-3">ü•ñ</div>
            <h3 class="font-serif font-bold text-lg text-primary-900 mb-2">Traditional Methods</h3>
            <p class="text-sm text-neutral-600">Slow fermentation for authentic flavor</p>
          </div>
          <div class="card text-center p-6 animate-fade-in" style="animation-delay: 0.1s;">
            <div class="text-4xl mb-3">üåæ</div>
            <h3 class="font-serif font-bold text-lg text-primary-900 mb-2">Quality Ingredients</h3>
            <p class="text-sm text-neutral-600">100% organic flour and natural starter</p>
          </div>
          <div class="card text-center p-6 animate-fade-in" style="animation-delay: 0.2s;">
            <div class="text-4xl mb-3">üíù</div>
            <h3 class="font-serif font-bold text-lg text-primary-900 mb-2">Made with Love</h3>
            <p class="text-sm text-neutral-600">Small batches, big attention to detail</p>
          </div>
        </div>
      </div>
    </section>

    <!-- Featured Products -->
    {featuredProducts.length > 0 && (
      <section class="section bg-white">
        <div class="container-custom">
          <div class="text-center mb-12">
            <h2 class="section-heading">
              Featured Products
            </h2>
            <p class="section-subheading mx-auto">
              Our most loved breads, baked fresh every day
            </p>
          </div>

          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
            {featuredProducts.map((product: any) => (
              <ProductCard product={product} />
            ))}
          </div>
        </div>
      </section>
    )}

    <!-- All Products -->
    <section id="products" class="section bg-neutral-50">
      <div class="container-custom">
        <div class="text-center mb-12">
          <h2 class="section-heading">
            Our Products
          </h2>
          <p class="section-subheading mx-auto">
            Browse our complete selection of artisan baked goods
          </p>
        </div>

        {products.length === 0 ? (
          <div class="card text-center py-20 max-w-2xl mx-auto">
            <div class="text-6xl mb-4">ü•ñ</div>
            <h3 class="text-2xl font-serif font-bold text-primary-900 mb-3">
              Fresh Batches Coming Soon!
            </h3>
            <p class="text-neutral-600 text-lg">
              We're preparing our next round of artisan breads. Check back soon!
            </p>
          </div>
        ) : (
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
            {products.map((product: any) => (
              <ProductCard product={product} />
            ))}
          </div>
        )}
      </div>
    </section>

    <!-- About Section -->
    <section id="about" class="section bg-white">
      <div class="container-custom">
        <div class="max-w-4xl mx-auto">
          <div class="text-center mb-12">
            <h2 class="section-heading">
              About Wellstone Breads
            </h2>
            <div class="w-20 h-1 bg-gradient-to-r from-primary-600 to-accent-600 mx-auto mb-8"></div>
          </div>

          <div class="card p-8 md:p-12">
            <div class="prose prose-lg max-w-none">
              <p class="text-lg text-neutral-700 mb-6 leading-relaxed">
                Welcome to Wellstone Breads! I'm <span class="font-serif font-bold text-primary-700">Nicole</span>,
                and I'm passionate about creating delicious, artisan breads using traditional sourdough methods
                and the highest quality ingredients.
              </p>

              <p class="text-lg text-neutral-700 mb-6 leading-relaxed">
                Every loaf is handcrafted with care in my home bakery, allowing me to maintain the highest
                standards of quality and freshness. From tangy sourdough to fluffy focaccia and soft pretzels,
                each product is made with love and attention to detail.
              </p>

              <p class="text-lg text-neutral-700 leading-relaxed">
                Thank you for supporting my small business. I look forward to sharing my passion for baking with you!
              </p>
            </div>

            <div class="mt-10 pt-8 border-t border-neutral-200 text-center">
              <p class="text-sm text-neutral-600 mb-4">
                Questions? Get in touch!
              </p>
              <a href="mailto:orders@wellstonebreads.com" class="btn-primary">
                Contact Nicole
              </a>
            </div>
          </div>
        </div>
      </div>
    </section>
  </main>

  <Footer />

  <!-- Shopping Cart Component -->
  <ShoppingCart client:load siteId={siteId} />

  <!-- Cart Script -->
  <script src="../components/cart-script.ts"></script>
</BaseLayout>
